var Charts=new function(){this.base=function(a,b){var c={};return c.data=a,c.draw=function(){},c.tooltips=function(){},c.labels=function(){},c.axes=function(){},c.access=function(a,b){return"Array"==typeof b?"function"==typeof a?d3.map(b,a):d3.map(b,function(b){return b[a]}):"function"==typeof a?a(b):b[a]},c.process=function(){return c.data.forEach(function(a,b){var d=0;if(!c.data[b].label){if(c.data[b]={label:a},!c.options.stack)return console.log("No stack specified"),!1;c.options.stack.forEach(function(e){c.data[b].values=c.data[b].values||[];var f={label:e.label,color:e.color,value:c.access(e.key,a),data:a};f.y0=d,f.y1=d+=c.access(e.key,a),c.data[b].values.push(f)}),c.data[b].total=c.data[b].values&&c.data[b].values.length?c.data[b].values[c.data[b].values.length-1].y1:0}}),c.options.sort&&"function"==typeof c.options.sort?c.data=c.data.sort(c.options.sort):c.options.sort&&c.data.sort(function(a,b){return"desc"==c.options.sort?b.total-a.total:a.total-b.total}),c.options.limit&&"function"==typeof c.data.slice&&(c.data=c.data.slice(0,c.options.limit)),c.data},c.coords=function(){c.y=d3.scale.ordinal().rangeRoundBands([c.options.margin.top,c.height],.1).domain(c.data.map(function(a){return c.access(c.options.axis.y.label,a)})),c.x=d3.scale.linear().rangeRound([c.width,0]).domain([d3.max(c.data,function(a){return a.total}),0])},c.legend=function(){if(c.options.legend){var a=c.svg.selectAll(".legend").data(c.options.stack).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(-20,"+20*b+")"});a.append("rect").attr("x",c.width-18).attr("width",18).attr("height",18).style("fill",function(a){return a.color}),a.append("text").attr("x",c.width-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a.legend})}},c.axis=function(){if(c.yAxis=d3.svg.axis().scale(c.y).orient("left"),c.xAxis=d3.svg.axis().scale(c.x).orient("bottom"),c.options.axis.x.show&&c.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+c.height+")").call(c.xAxis),c.options.axis.y.show){c.svg.append("g").attr("class","y axis").call(c.yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end")}},c.setup=function(){return c.options.dom?(c.element=$(c.options.dom),c.element.children("svg").remove(),c.options.width?c.width=c.options.width-(c.options.margin.left+c.options.margin.right):(c.options.width=c.element.width(),c.width=c.element.width()-(c.options.margin.left+c.options.margin.right)),c.options.height?c.height=c.options.height-(c.options.margin.left+c.options.margin.right):(c.options.height=c.element.height(),c.height=c.element.height()-(c.options.margin.left+c.options.margin.right)),c.element.css({width:c.options.width,height:c.options.height}),c.element=d3.selectAll(c.options.dom),c.svg=c.element.append("svg").attr("width",c.width+c.options.margin.left+c.options.margin.right).attr("height",c.height+c.options.margin.top+c.options.margin.bottom).append("g").attr("class","holder").attr("transform","translate("+c.options.margin.left+","+c.options.margin.top+")"),c.element):!1},c.update=function(){},c.resize=function(){},c.defaults={dom:"#options",create:!0,height:400,width:!1,margin:{top:20,right:20,bottom:20,left:40},label:function(a){return a.label},stack:[{key:"count",label:"Count",color:"#006699"},{key:"likes",label:"Comments",color:"#996600"},{key:"comments",label:"Likes",color:"#FF0099"}],legend:!0,chartLabel:!1,axis:{x:{show:!0},y:{show:!0}},limit:!1},c.options=_.extend(c.defaults,b),c}};Charts.bar=function(a,b){var c=new Charts.base(a,b);c.draw=function(){var b=c.svg.selectAll(".state").data(a).enter().append("g").attr("class","g").attr("transform",function(a){return"translate(0,"+c.y(c.access(c.options.axis.y.label,a))+")"});b.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("height",c.y.rangeBand()).attr("x",function(a){return c.x(a.y0)}).attr("width",function(a){return c.x(a.y1)-c.x(a.y0)}).style("fill",function(a){return a.color}),b.selectAll("text").data(function(a){return a.values}).enter().append("text").attr("x",function(a){return c.x(a.y0)+4}).attr("y",function(a,b){return 10*b+10}).attr("class","label").style("text-anchor","left").text(function(a,b){return a.value>0?c.access(c.options.stack[b].label,a):void 0})},c.create=function(){c.setup(),c.process(),c.coords(),c.draw(),c.axis(),c.legend()},c.create()},Charts.column=function(a,b){var c=new Charts.base(a,b);return c.coords=function(){c.x=d3.scale.ordinal().rangeRoundBands([0,c.width],.1).domain(c.data.map(function(a){return c.access(c.options.axis.x.label,a)})),c.y=d3.scale.linear().rangeRound([c.height,0]).domain([0,d3.max(c.data,function(a){return a.total})])},c.draw=function(){var a=c.svg.selectAll(".bar").data(c.data).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+c.x(c.access(c.options.axis.x.label,a))+", 0)"});a.selectAll("rect").data(function(a){return a.values}).enter().append("rect").attr("width",c.x.rangeBand()).attr("y",function(a){return c.y(a.y1)}).attr("height",function(a){return Math.abs(c.y(a.y1)-c.y(a.y0))}).style("fill",function(a){return a.color}),a.selectAll("text").data(function(a){return a.values}).enter().append("text").attr("y",function(a){return c.y(a.y1)}).attr("x",6).attr("class","label").style("text-anchor","left").text(function(a,b){return c.access(c.options.stack[b].label,a)})},c.create=function(){c.setup(),c.process(),c.coords(),c.draw(),c.axis(),c.legend()},1==c.options.create&&c.create(),c},Charts.pie=function(a,b){var c=new Charts.base(a,b);return c.draw=function(){var a=Math.min(c.width,c.height)/2,b=(d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),d3.svg.arc().outerRadius(a*c.options.radius).innerRadius(a*c.options.innerRadius)),d=d3.layout.pie().sort(null).value(function(a){return c.access(c.options.stack[0].key,a)});c.svg.attr("transform","translate("+c.width/2+","+c.height/2+")");var e=c.svg.selectAll(".arc").data(d(c.data)).enter().append("g").attr("class","chart-unit labelled");e.append("path").attr("d",b).style("fill",function(a){return a.data.color}),e.append("text").attr("transform",function(a){return"translate("+b.centroid(a)+")"}).attr("dy",".35em").attr("class","label").style("text-anchor","middle").text(function(a){return console.log(c.access(c.options.stack[0].label,a)),c.access(c.options.stack[0].label,a)})},c.create=function(){c.setup(),c.draw()},1==c.options.create&&c.create(),c},Charts.line=function(a,b){var c=new Charts.base(a,b);c.coords=function(){if(1==c.options.timeseries){if(c.x=d3.time.scale().range([0,c.width]),c.options.axis.x.extent)var b=c.options.axis.x.extent;else var b=d3.extent(a,function(a){return c.access(c.options.axis.x.label,a)});c.x.domain(b)}else c.x=d3.scale.ordinal().rangePoints([0,c.width],.1).domain(c.data.map(function(a){return c.access(c.options.axis.x.label,a)}));c.y=d3.scale.linear().rangeRound([c.height,0]).domain([0,d3.max(c.data,function(a){return a.total})])},c.draw=function(){if(c.options&&c.options.stack){var a=[];c.options.stack.forEach(function(b){if(c.line=d3.svg.line().interpolate(c.options.interpolate||"cardinal").x(function(a){return c.x(c.access(c.options.axis.x.label,a))}).y(function(a){return c.y(c.access(b.key,a.label))}),c.options.timerseries);else{c.x(c.access(c.options.axis.x.label,c.data[1]))/2}{var d=c.svg.append("g").attr("class","line-obj"),e=(d.append("path").attr("class","line").attr("d",c.line(c.data)).style("fill","none").style("stroke",b.color).style("stroke-width",1),d.selectAll("circle").data(c.data).enter().append("circle").attr("cx",function(a){return c.x(c.access(c.options.axis.x.label,a))}).attr("cy",function(a){return c.y(c.access(b.key,a.label))}).attr("r",3).style("fill","#666").style("pointer-events","none"));d.selectAll("text").data(c.data).enter().append("text").attr("x",function(a){return c.x(c.access(c.options.axis.x.label,a))}).attr("y",function(a){return c.y(c.access(b.key,a.label))}).attr("class","label").style("text-anchor","left").text(function(a){return c.access(b.label,a.label)})}a.push(e[0])})}},c.create=function(){c.setup(),c.process(),c.coords(),c.draw(),c.axis(),c.legend()},c.create()};